---
tags:
  - 음향
  - Technology
  - Programming
  - Music
aliases: 
date_created: 2024-09-24
up:
  - "[[Javascript Asynchronous Programming]]"
Habitus:
  - "[[◦ Knowledge]]"
persona:
  - "[[🔥 Programmer]]"
  - "[[🔥 Sound]]"
---
# JavaScript의 실행 메커니즘 이해하기 - 사운드 엔지니어를 위한 안내서

JavaScript는 싱글 스레드 언어로, 동기와 비동기 코드를 효율적으로 처리하기 위해 **콜 스택**, **이벤트 루프**, 그리고 **태스크 큐**를 사용합니다. 이 글에서는 사운드 엔지니어의 작업 흐름을 비유로 들어 JavaScript의 실행 메커니즘을 쉽게 이해할 수 있도록 설명하겠습니다.

## 콜 스택(Call Stack)

### 🎛️ 믹싱 콘솔의 현재 작업 채널

콜 스택은 현재 실행 중인 함수들이 쌓이는 공간입니다. 이는 마치 사운드 엔지니어가 믹싱 콘솔에서 특정 채널을 조작하는 것과 같습니다. 엔지니어는 한 번에 하나의 채널에 집중하여 EQ 조정, 이펙트 적용 등의 작업을 수행합니다. 작업이 완료되면 다음 채널로 넘어가죠.

예를 들어, 보컬 트랙의 EQ를 조정하는 동안에는 다른 트랙을 건드리지 않습니다. 이처럼 콜 스택은 현재 처리 중인 작업의 순서를 관리하며, 상위에 있는 작업이 완료되면 그 아래의 작업을 이어서 처리합니다.

## 이벤트 루프(Event Loop)

### 🔄 작업 스케줄러의 역할

이벤트 루프는 콜 스택과 태스크 큐를 관리하여 비동기 작업이 언제 실행될지 결정하는 역할을 합니다. 이는 사운드 엔지니어의 어시스턴트가 작업 스케줄을 관리하며, 엔지니어가 현재 작업을 마치면 다음에 어떤 작업을 해야 할지 알려주는 것과 비슷합니다.

어시스턴트는 긴급한 작업과 일반 작업을 구분하여 우선순위를 정합니다. 긴급한 수정 사항이 있으면 즉시 엔지니어에게 알리고, 일반적인 작업은 예정된 순서에 따라 안내합니다. 이벤트 루프도 이와 같이 마이크로태스크와 매크로태스크를 구분하여 처리합니다.

## 태스크 큐(Task Queue)

### 📋 작업 대기 목록

태스크 큐는 비동기 작업의 콜백 함수들이 대기하는 곳입니다. 이는 엔지니어가 앞으로 처리해야 할 작업 목록과 같습니다. 태스크 큐는 우선순위에 따라 **마이크로태스크 큐**와 **매크로태스크 큐**로 나뉩니다.

### 마이크로태스크 큐(Microtask Queue)

마이크로태스크 큐는 긴급하게 처리해야 하는 작은 작업들이 대기하는 곳입니다. 예를 들어, 믹싱 중에 발견된 작은 노이즈 제거나 즉각적인 페이드 인/아웃 작업이 여기에 해당합니다. 이러한 작업은 우선적으로 처리되어야 하므로 이벤트 루프는 마이크로태스크 큐를 먼저 확인합니다.

### 매크로태스크 큐(Macro Task Queue)

매크로태스크 큐는 일반적인 작업들이 대기하는 곳입니다. 예를 들어, 기타 트랙에 리버브를 적용하거나 드럼 트랙의 컴프레서를 조정하는 등의 예정된 작업이 여기에 포함됩니다. 마이크로태스크가 모두 처리된 후에야 매크로태스크가 실행됩니다.

## 음향 예시로 보는 JavaScript 실행 흐름

### 🎚️ 믹싱 콘솔에서의 작업 (JavaScript 런타임 환경)

당신은 대형 믹싱 콘솔 앞에 앉아 있습니다. 이 콘솔이 바로 JavaScript 런타임 환경입니다.

#### 1. 메인 트랙 작업 시작 (전역 실행 컨텍스트 생성)

믹싱 세션을 시작하면서 메인 페이더를 조정합니다. (JavaScript 코드 실행이 시작되고 전역 실행 컨텍스트가 생성되어 콜 스택에 푸시됩니다.)

#### 2. 보컬 EQ 조정 (함수 호출)

보컬 채널의 EQ를 조정하기 위해 해당 섹션으로 이동합니다. (함수가 호출되면 새로운 실행 컨텍스트가 생성되어 콜 스택에 푸시됩니다.)

```javascript
function adjustVocalEQ() {
    // EQ 조정 로직
}
adjustVocalEQ();
```

#### 3. 비동기 작업 요청 (비동기 API 호출)

EQ를 조정하면서 동시에 어시스턴트에게 "기타에 리버브 추가"와 "노이즈 제거" 작업을 요청합니다. (비동기 함수들이 호출되고, Web API에 작업이 등록됩니다.)

```javascript
setTimeout(() => addReverbToGuitar(), 0); // 매크로태스크
Promise.resolve().then(() => removeNoise()); // 마이크로태스크
```

#### 4. 보컬 EQ 조정 완료 (함수 실행 완료)

보컬 EQ 조정을 마치고 해당 채널에서 손을 뗍니다. (함수 실행이 완료되고 해당 실행 컨텍스트가 콜 스택에서 제거됩니다.)

#### 5. 어시스턴트의 작업 확인 (이벤트 루프 동작)

잠시 콘솔에서 손을 떼고 어시스턴트를 바라봅니다. 어시스턴트는 요청받은 작업들의 우선순위를 확인하고 있습니다. (이벤트 루프가 콜 스택이 비었는지 확인하고, 태스크 큐를 검사합니다.)

#### 6. 긴급 노이즈 제거 작업 (마이크로태스크 실행)

어시스턴트가 "노이즈 제거 작업이 긴급합니다!"라고 알려줍니다. 즉시 노이즈 제거 작업을 수행합니다. (마이크로태스크 큐의 작업이 콜 스택으로 이동하여 실행됩니다.)

```javascript
function removeNoise() {
    // 노이즈 제거 로직
}
```

#### 7. 기타 리버브 추가 (매크로태스크 실행)

노이즈 제거 후, 어시스턴트가 "이제 기타에 리버브를 추가할 차례입니다"라고 안내합니다. 기타 채널로 이동하여 리버브를 추가합니다. (매크로태스크 큐의 작업이 콜 스택으로 이동하여 실행됩니다.)

```javascript
function addReverbToGuitar() {
    // 리버브 추가 로직
}
```

#### 8. 새로운 작업 확인 (이벤트 루프 반복)

리버브 추가를 마치고 다시 어시스턴트를 바라봅니다. 새로운 작업이 있는지 확인합니다. (이벤트 루프가 다시 태스크 큐를 확인하며 새로운 작업이 있는지 검사합니다.)

### 🔄 반복 과정

이러한 과정이 계속 반복되면서 모든 믹싱 작업이 순차적으로, 그리고 효율적으로 처리됩니다. (JavaScript 런타임은 이벤트 루프를 통해 비동기 작업들을 관리하며 싱글 스레드에서 동시성을 구현합니다.)

이 과정을 통해 복잡한 믹싱 작업(JavaScript 프로그램)이 체계적으로 진행되며, 긴급한 작업(마이크로태스크)과 일반 작업(매크로태스크)이 적절히 처리되는 것을 볼 수 있습니다.
### 💻 코드 예시와 비교

```javascript
console.log('보컬 트랙 EQ 조정 시작'); // 동기 작업

setTimeout(() => {
  console.log('기타 트랙 리버브 적용'); // 매크로태스크
}, 0);

Promise.resolve().then(() => {
  console.log('노이즈 제거'); // 마이크로태스크
});

console.log('보컬 트랙 EQ 조정 완료'); // 동기 작업
```

**출력 결과:**

```
보컬 트랙 EQ 조정 시작
보컬 트랙 EQ 조정 완료
노이즈 제거
기타 트랙 리버브 적용
```

- **동기 작업**: '보컬 트랙 EQ 조정 시작'과 '보컬 트랙 EQ 조정 완료'는 즉시 실행됩니다.
- **마이크로태스크**: '노이즈 제거'는 긴급한 작업으로, 동기 작업이 완료된 후 바로 실행됩니다.
- **매크로태스크**: '기타 트랙 리버브 적용'은 예정된 작업으로, 마이크로태스크가 모두 처리된 후 실행됩니다.

## 정리

JavaScript의 실행 메커니즘은 사운드 엔지니어의 작업 흐름과 유사합니다.

- **콜 스택**은 현재 집중하여 처리하는 작업입니다.
- **이벤트 루프**는 작업의 순서를 관리하여 다음에 어떤 작업을 처리할지 결정합니다.
- **태스크 큐**는 대기 중인 작업들의 목록이며, 우선순위에 따라 마이크로태스크와 매크로태스크로 나뉩니다.
  - **마이크로태스크**: 즉각적으로 처리해야 하는 긴급한 작업들입니다.
  - **매크로태스크**: 예정된 일반 작업들입니다.
